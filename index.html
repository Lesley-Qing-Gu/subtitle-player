<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Subtitle Player</title>

<style>
html,body{
  margin:0;
  padding:0;
  height:100%;
  background:black;
  font-family: "Georgia", "Times New Roman", serif;
  overflow:hidden;
}

#container{
  height:100%;
  display:flex;
  flex-direction:column;
}

#display{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
  text-align:center;
  padding:20px;
  color:#4cc3ff;
  font-size:42px;
  line-height:1.4;
  user-select:none;
  transition: opacity 0.15s;
}

#controls{
  background:#000;
  padding:10px;
  display:flex;
  align-items:center;
  gap:8px;
  border-top:1px solid #222;
}

button{
  background:#111;
  color:#4cc3ff;
  border:1px solid #333;
  padding:8px 12px;
  font-size:16px;
  border-radius:4px;
}

.font-btn{
  width:42px;
}

input[type="range"]{
  flex:1;
  height:40px;
}

input[type="file"]{
  color:#4cc3ff;
  font-size:14px;
}

@media (max-width:600px){
  #display{ font-size:28px; }
}
</style>
</head>
<body>

<div id="container">
  <div id="display">Upload SRT to start</div>

  <div id="controls">
    <input type="file" id="fileInput" accept=".srt">

    <button id="playBtn">▶</button>

    <button class="font-btn" id="fontDown">A−</button>
    <button class="font-btn" id="fontUp">A+</button>

    <input type="range" id="timeline" min="0" max="100" value="0" step="0.01">

    <span id="timeLabel" style="color:#4cc3ff;font-size:14px">0.0s</span>
  </div>
</div>

<script>
let subtitles = [];
let duration = 0;
let playing = false;
let currentTime = 0;
let rafId = null;
let isSeeking = false;

let fontSize = 42;
const MIN_FONT = 18;
const MAX_FONT = 96;

/* playback control */
let playbackRate = 1;
let lastFrameTime = 0;

const display = document.getElementById("display");
const fileInput = document.getElementById("fileInput");
const playBtn = document.getElementById("playBtn");
const timeline = document.getElementById("timeline");
const timeLabel = document.getElementById("timeLabel");
const fontUpBtn = document.getElementById("fontUp");
const fontDownBtn = document.getElementById("fontDown");

function applyFontSize(){
  display.style.fontSize = fontSize + "px";
}

function parseTime(t){
  const [h,m,s] = t.split(':');
  const [sec,ms] = s.split(',');
  return (+h)*3600 + (+m)*60 + (+sec) + (+ms)/1000;
}

function parseSRT(data){
  const blocks = data.trim().split(/\n\n+/);
  const subs = [];
  blocks.forEach(b=>{
    const lines = b.split("\n");
    if(lines.length>=3){
      const times = lines[1].split(" --> ");
      subs.push({
        start: parseTime(times[0]),
        end: parseTime(times[1]),
        text: lines.slice(2).join("\n")
      });
    }
  });
  return subs;
}

fileInput.onchange = async e=>{
  const file = e.target.files[0];
  if(!file) return;
  const text = await file.text();
  subtitles = parseSRT(text);
  duration = subtitles[subtitles.length-1].end;
  timeline.max = duration.toFixed(2);
  currentTime = 0;
  playing = false;
  playBtn.innerText="▶";
  updateDisplay(true);
};

playBtn.onclick = ()=>{
  if(subtitles.length===0) return;

  playing = !playing;
  playBtn.innerText = playing ? "⏸" : "▶";
  if(playing){
    lastFrameTime = performance.now();
    loop();
  }else{
    cancelAnimationFrame(rafId);
  }
};

timeline.addEventListener("input", ()=>{
  isSeeking = true;
  currentTime = parseFloat(timeline.value);
  updateDisplay(false);
});

timeline.addEventListener("change", ()=>{
  isSeeking = false;
  if(playing){
    lastFrameTime = performance.now();
  }
});

fontUpBtn.onclick = ()=>{
  fontSize = Math.min(MAX_FONT, fontSize + 4);
  applyFontSize();
};

fontDownBtn.onclick = ()=>{
  fontSize = Math.max(MIN_FONT, fontSize - 4);
  applyFontSize();
};

function updateDisplay(updateSlider=true){
  const sub = subtitles.find(s=>currentTime>=s.start && currentTime<=s.end);
  display.innerText = sub ? sub.text : "";

  if(updateSlider && !isSeeking){
    timeline.value = currentTime;
  }

  timeLabel.innerText = currentTime.toFixed(1)+"s";
}

function loop(){
  if(!playing) return;

  const now = performance.now();
  if(!lastFrameTime) lastFrameTime = now;

  const delta = (now - lastFrameTime) / 1000;
  lastFrameTime = now;

  currentTime += delta * playbackRate;

  if(currentTime >= duration){
    playing = false;
    playBtn.innerText="▶";
    return;
  }

  updateDisplay(true);
  rafId = requestAnimationFrame(loop);
}

/* tap to play / pause */
display.addEventListener("click", ()=>{
  playBtn.click();
});

/* long press = 2x speed */
function setFastForward(on){
  playbackRate = on ? 2 : 1;
  display.style.opacity = on ? "0.75" : "1";
}

/* mobile */
display.addEventListener("touchstart", e=>{
  e.preventDefault();
  if(playing) setFastForward(true);
});
display.addEventListener("touchend", ()=>setFastForward(false));
display.addEventListener("touchcancel", ()=>setFastForward(false));

/* desktop */
display.addEventListener("mousedown", ()=>{
  if(playing) setFastForward(true);
});
display.addEventListener("mouseup", ()=>setFastForward(false));
display.addEventListener("mouseleave", ()=>setFastForward(false));

applyFontSize();
</script>

</body>
</html>
